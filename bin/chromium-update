#!/usr/bin/env ruby

# Script for OS X users to install and run the latest nightly Chromium build
#
# Save as file as "chromium_update" in your $PATH; and chmod +x chromium_update
#
# Written by Dr Nic Williams and Bo Jeanes from Mocra; drnicwilliams@gmail.com

require "fileutils"
include FileUtils
chdir("/tmp") do
  %x[rm -rf chrome-mac*]
  puts "Fetching latest nightly..."
  %x[curl -O http://build.chromium.org/buildbot/continuous/mac/LATEST/chrome-mac.zip]
  %x[unzip chrome-mac.zip]

  chromium_procs = `ps ax | grep Chromium | grep -v grep`
  unless chromium_procs.empty?
    print "Please quit Chromium (I'll restart it in a minute, all shiny and new)..."
    gets
  end

  puts "Deleting existing Chromium.app:"
  %x[sudo rm -rf /Applications/Chromium.app]
  cp_r "chrome-mac/Chromium.app", "/Applications"
end
%x[open -a /Applications/Chromium.app]
